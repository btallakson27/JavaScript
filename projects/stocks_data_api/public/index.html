<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Data Web Scraper</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        header { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
        button { padding: 8px 12px; border-radius: 6px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #f0f0f0; }
    </style>
</head>

<body>
    <header>
        <input id="ticker" placeholder="Enter stock ticker ..." />
        <button>Search</button>
    </header>
    <main></main>

    <script>
        const tickerInput = document.getElementById('ticker')
        const sendBtn = document.querySelector('button')
        const mainContainer = document.querySelector('main')

        async function fetchStockData() {
            const stock_ticker = tickerInput.value.trim()
            if (!stock_ticker) {
                mainContainer.innerText = 'Please enter a stock ticker.'
                return
            }

            try {
                const res = await fetch('/api', {
                    method: 'POST',
                    headers: { 'content-type': 'application/json' },
                    body: JSON.stringify({ stock_ticker })
                })

                if (!res.ok) {
                    throw new Error(`Server responded with status ${res.status}`)
                }

                const data = await res.json()
                const prices = data?.prices || []

                mainContainer.innerHTML = ''

                if (!prices.length) {
                    mainContainer.innerText = 'No data found for this ticker.'
                    return
                }

                // Create table
                const table = document.createElement('table')

                // Table header
                const thead = document.createElement('thead')
                const headerRow = document.createElement('tr')
                ;['Date', 'Close Price'].forEach(text => {
                    const th = document.createElement('th')
                    th.innerText = text
                    headerRow.appendChild(th)
                })
                thead.appendChild(headerRow)
                table.appendChild(thead)

                // Table body
                const tbody = document.createElement('tbody')
                prices.forEach(entry => {
                    const row = document.createElement('tr')

                    const dateCell = document.createElement('td')
                    dateCell.innerText = entry.date || '-'
                    row.appendChild(dateCell)

                    const closeCell = document.createElement('td')
                    closeCell.innerText =
                        typeof entry.close === 'number'
                            ? `$${entry.close.toFixed(2)}`
                            : '-'
                    row.appendChild(closeCell)

                    tbody.appendChild(row)
                })
                table.appendChild(tbody)

                mainContainer.appendChild(table)
            } catch (err) {
                console.error('Error fetching stock data:', err)
                mainContainer.innerText = 'Error fetching stock data. Please try again.'
            }
        }

        sendBtn.addEventListener('click', fetchStockData)
    </script>
</body>

</html>
